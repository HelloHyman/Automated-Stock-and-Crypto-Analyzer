<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìà Stock Analyzer Dashboard</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Plotly.js -->
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    
    <style>
        body {
            background-color: #f8f9fa;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }
        .hero {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 3rem 0;
            margin-bottom: 2rem;
        }
        .card {
            border: none;
            box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
        }
        .stat-card {
            transition: transform 0.2s;
        }
        .stat-card:hover {
            transform: translateY(-5px);
        }
        #loadingSpinner {
            display: none;
        }
        .indicator-tag {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.875rem;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <!-- Hero Section -->
    <div class="hero">
        <div class="container">
            <h1 class="display-4 fw-bold mb-2">üìà Stock Analyzer Dashboard</h1>
            <p class="lead mb-0">Real-time stock and cryptocurrency technical analysis</p>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container mb-5">
        <!-- Input Section -->
        <div class="row mb-4">
            <div class="col-md-6 mb-3">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title mb-3">Enter Symbol</h5>
                        <div class="input-group">
                            <input type="text" class="form-control" id="symbolInput" placeholder="e.g., AAPL, BTC-USD, TSLA" value="AAPL">
                            <button class="btn btn-primary" onclick="analyzeStock()">Analyze</button>
                        </div>
                        <small class="text-muted">Stocks: AAPL, MSFT, GOOGL | Crypto: BTC-USD, ETH-USD</small>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6 mb-3">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title mb-3">Timeframe</h5>
                        <select class="form-select" id="timeframeSelect">
                            <option value="1d">1 Day</option>
                            <option value="5d">5 Days</option>
                            <option value="1mo">1 Month</option>
                            <option value="3mo">3 Months</option>
                            <option value="6mo" selected>6 Months</option>
                            <option value="1y">1 Year</option>
                            <option value="2y">2 Years</option>
                            <option value="5y">5 Years</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <!-- Moving Averages -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title mb-3">Moving Averages</h5>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="checkbox" id="ma20" value="20">
                            <label class="form-check-label" for="ma20">20 MA</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="checkbox" id="ma50" value="50" checked>
                            <label class="form-check-label" for="ma50">50 MA</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="checkbox" id="ma100" value="100">
                            <label class="form-check-label" for="ma100">100 MA</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="checkbox" id="ma200" value="200" checked>
                            <label class="form-check-label" for="ma200">200 MA</label>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Stock Info -->
        <div id="stockInfo" class="mb-4"></div>

        <!-- Loading Spinner -->
        <div id="loadingSpinner" class="text-center mb-4">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-2">Fetching data...</p>
        </div>

        <!-- Chart -->
        <div class="card mb-4">
            <div class="card-body">
                <div id="stockChart"></div>
            </div>
        </div>

        <!-- Analysis Summary -->
        <div id="analysisSummary"></div>
    </div>

    <!-- Footer -->
    <footer class="bg-light py-4 mt-5">
        <div class="container text-center text-muted">
            <p class="mb-0">‚ö†Ô∏è Disclaimer: This tool is for educational purposes only. Not financial advice.</p>
            <p class="mb-0 mt-2">Made with ‚ù§Ô∏è using Plotly.js | Data from Yahoo Finance</p>
        </div>
    </footer>

    <script>
        // Calculate technical indicators
        function calculateRSI(prices, period = 14) {
            if (prices.length < period) return Array(prices.length).fill(null);
            
            const rsi = [];
            const gains = [];
            const losses = [];
            
            for (let i = 1; i < prices.length; i++) {
                const change = prices[i] - prices[i - 1];
                gains.push(change > 0 ? change : 0);
                losses.push(change < 0 ? -change : 0);
            }
            
            let avgGain = gains.slice(0, period).reduce((a, b) => a + b) / period;
            let avgLoss = losses.slice(0, period).reduce((a, b) => a + b) / period;
            
            rsi.push(null); // First value is null
            for (let i = 0; i < period; i++) rsi.push(null);
            
            for (let i = period; i < gains.length; i++) {
                avgGain = (avgGain * (period - 1) + gains[i]) / period;
                avgLoss = (avgLoss * (period - 1) + losses[i]) / period;
                const rs = avgGain / (avgLoss || 0.00001);
                rsi.push(100 - (100 / (1 + rs)));
            }
            
            return rsi;
        }

        function calculateMA(data, period) {
            const ma = [];
            for (let i = 0; i < data.length; i++) {
                if (i < period - 1) {
                    ma.push(null);
                } else {
                    const sum = data.slice(i - period + 1, i + 1).reduce((a, b) => a + b);
                    ma.push(sum / period);
                }
            }
            return ma;
        }

        async function analyzeStock() {
            const symbol = document.getElementById('symbolInput').value.trim().toUpperCase();
            const timeframe = document.getElementById('timeframeSelect').value;
            
            if (!symbol) {
                alert('Please enter a stock symbol');
                return;
            }

            // Show loading
            document.getElementById('loadingSpinner').style.display = 'block';
            document.getElementById('stockChart').innerHTML = '';
            document.getElementById('stockInfo').innerHTML = '';
            document.getElementById('analysisSummary').innerHTML = '';

            try {
                // Fetch data from Yahoo Finance API via proxy
                const apiUrl = `https://query1.finance.yahoo.com/v8/finance/chart/${symbol}?range=${timeframe}&interval=1d`;
                
                const response = await fetch(apiUrl);
                const data = await response.json();
                
                if (!data.chart.result || data.chart.result.length === 0) {
                    throw new Error('No data found for this symbol');
                }

                const result = data.chart.result[0];
                const timestamps = result.timestamp.map(t => new Date(t * 1000));
                const quote = result.indicators.quote[0];
                const meta = result.meta;

                // Stock info
                const currentPrice = meta.regularMarketPrice || quote.close[quote.close.length - 1];
                displayStockInfo(symbol, meta.longName || symbol, currentPrice, meta);

                // Calculate indicators
                const rsi = calculateRSI(quote.close);
                const lastRSI = rsi[rsi.length - 1];

                // Create candlestick chart
                const candlestick = {
                    x: timestamps,
                    open: quote.open,
                    high: quote.high,
                    low: quote.low,
                    close: quote.close,
                    type: 'candlestick',
                    name: symbol,
                    increasing: {line: {color: '#00C853'}},
                    decreasing: {line: {color: '#D50000'}}
                };

                const traces = [candlestick];

                // Add moving averages
                const maColors = {20: '#FF6B6B', 50: '#4ECDC4', 100: '#45B7D1', 200: '#96CEB4'};
                
                if (document.getElementById('ma20').checked) {
                    traces.push({
                        x: timestamps,
                        y: calculateMA(quote.close, 20),
                        type: 'scatter',
                        mode: 'lines',
                        name: '20 MA',
                        line: {color: maColors[20], width: 2}
                    });
                }
                
                if (document.getElementById('ma50').checked) {
                    traces.push({
                        x: timestamps,
                        y: calculateMA(quote.close, 50),
                        type: 'scatter',
                        mode: 'lines',
                        name: '50 MA',
                        line: {color: maColors[50], width: 2}
                    });
                }
                
                if (document.getElementById('ma100').checked) {
                    traces.push({
                        x: timestamps,
                        y: calculateMA(quote.close, 100),
                        type: 'scatter',
                        mode: 'lines',
                        name: '100 MA',
                        line: {color: maColors[100], width: 2}
                    });
                }
                
                if (document.getElementById('ma200').checked) {
                    traces.push({
                        x: timestamps,
                        y: calculateMA(quote.close, 200),
                        type: 'scatter',
                        mode: 'lines',
                        name: '200 MA',
                        line: {color: maColors[200], width: 2}
                    });
                }

                const layout = {
                    title: {
                        text: `${symbol} Technical Analysis`,
                        font: {size: 24, weight: 'bold'}
                    },
                    xaxis: {
                        rangeslider: {visible: false},
                        title: 'Date'
                    },
                    yaxis: {
                        title: 'Price ($)'
                    },
                    height: 600,
                    hovermode: 'x unified',
                    showlegend: true,
                    legend: {
                        orientation: 'h',
                        y: -0.2
                    }
                };

                Plotly.newPlot('stockChart', traces, layout, {responsive: true});

                // Display analysis
                displayAnalysis(symbol, currentPrice, lastRSI);

            } catch (error) {
                console.error('Error:', error);
                document.getElementById('stockChart').innerHTML = `
                    <div class="alert alert-danger">
                        Error: ${error.message}. Please check the symbol and try again.
                    </div>`;
            } finally {
                document.getElementById('loadingSpinner').style.display = 'none';
            }
        }

        function displayStockInfo(symbol, name, price, meta) {
            const html = `
                <div class="card">
                    <div class="card-body">
                        <h4 class="card-title">${name} (${symbol})</h4>
                        <div class="row mt-3">
                            <div class="col-md-3">
                                <div class="stat-card">
                                    <h6 class="text-muted">Current Price</h6>
                                    <h3 class="text-primary">$${price.toFixed(2)}</h3>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="stat-card">
                                    <h6 class="text-muted">Previous Close</h6>
                                    <h5>${meta.chartPreviousClose ? '$' + meta.chartPreviousClose.toFixed(2) : 'N/A'}</h5>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="stat-card">
                                    <h6 class="text-muted">Day Range</h6>
                                    <h5>${meta.regularMarketDayLow ? '$' + meta.regularMarketDayLow.toFixed(2) + ' - $' + meta.regularMarketDayHigh.toFixed(2) : 'N/A'}</h5>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="stat-card">
                                    <h6 class="text-muted">Currency</h6>
                                    <h5>${meta.currency || 'USD'}</h5>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            document.getElementById('stockInfo').innerHTML = html;
        }

        function displayAnalysis(symbol, price, rsi) {
            let alertClass = 'info';
            let rsiText = 'Neutral';
            
            if (rsi > 70) {
                alertClass = 'warning';
                rsiText = 'Overbought ‚ö†Ô∏è';
            } else if (rsi < 30) {
                alertClass = 'success';
                rsiText = 'Oversold ‚úÖ';
            }

            const html = `
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">üìä Technical Analysis Summary</h5>
                        <hr>
                        <div class="row">
                            <div class="col-md-4">
                                <h6>Current Price</h6>
                                <p class="fs-5"><strong>$${price.toFixed(2)}</strong></p>
                            </div>
                            <div class="col-md-4">
                                <h6>RSI (14)</h6>
                                <p class="fs-5">
                                    <strong>${rsi ? rsi.toFixed(1) : 'N/A'}</strong>
                                    <span class="indicator-tag bg-${alertClass} text-white ms-2">${rsiText}</span>
                                </p>
                            </div>
                            <div class="col-md-4">
                                <h6>Signal</h6>
                                <p class="fs-5">
                                    ${rsi < 30 ? '<span class="badge bg-success">Potential Buy</span>' : 
                                      rsi > 70 ? '<span class="badge bg-danger">Potential Sell</span>' : 
                                      '<span class="badge bg-secondary">Hold</span>'}
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            document.getElementById('analysisSummary').innerHTML = html;
        }

        // Allow Enter key to analyze
        document.getElementById('symbolInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                analyzeStock();
            }
        });

        // Load default stock on page load
        window.onload = function() {
            analyzeStock();
        };
    </script>
</body>
</html>

